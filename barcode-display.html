<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .barcode-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 4px;
        }
        .barcode-png {
            display: block;
            margin: 20px auto;
        }
        .barcode-text {
            margin-top: 15px;
            font-size: 18px;
            color: #555;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .error {
            color: #d32f2f;
            text-align: center;
            padding: 20px;
            background: #ffebee;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Barcode Display</h1>
        <div id="content" class="loading">Loading barcode...</div>
    </div>

    <script>
        // Get parameters from query string
        const urlParams = new URLSearchParams(window.location.search);
        const barcodeText = urlParams.get('text');
        const barcodeType = urlParams.get('type') || 'CODE128';
        const barcodeWidth = urlParams.get('width') || '2';
        const barcodeHeight = urlParams.get('height') || '100';
        const contentDiv = document.getElementById('content');

        if (barcodeText) {
            // Construct URL to the generator page with all parameters
            const generatorUrl = 'barcode-generator.html?text=' + encodeURIComponent(barcodeText) +
                                '&type=' + encodeURIComponent(barcodeType) +
                                '&width=' + encodeURIComponent(barcodeWidth) +
                                '&height=' + encodeURIComponent(barcodeHeight);
            
            // Fetch the base64 string from the generator
            fetch(generatorUrl)
                .then(response => response.text())
                .then(base64String => {
                    console.log("___ base64String: "+base64String);
                    
                    // Check if it's a valid base64 image string
                    if (base64String.startsWith('data:image')) {
                        // Display the barcode image
                        contentDiv.innerHTML = `
                            <div class="barcode-container">
                                <img class="barcode-png" style="display: block;" alt="Barcode" src="${base64String}">
                                <div class="barcode-text">
                                    <strong>Text:</strong> ${barcodeText}<br>
                                    <strong>Type:</strong> ${barcodeType}<br>
                                    <strong>Width:</strong> ${barcodeWidth} | <strong>Height:</strong> ${barcodeHeight}
                                </div>
                            </div>
                        `;
                    } else {
                        // It's an error message
                        contentDiv.className = 'error';
                        contentDiv.innerHTML = base64String;
                    }
                })
                .catch(error => {
                    contentDiv.className = 'error';
                    contentDiv.innerHTML = `Error loading barcode: ${error.message}`;
                });
        } else {
            contentDiv.className = 'error';
            contentDiv.innerHTML = `
                No barcode text provided.<br><br>
                <strong>Usage:</strong> Add ?text=YOUR_TEXT to the URL<br>
                <strong>Optional parameters:</strong> &type=CODE128&width=2&height=100<br>
                <strong>Example:</strong> ${window.location.href}?text=123456789&type=CODE39&width=3&height=150<br><br>
                <strong>Supported types:</strong> CODE128, CODE39, EAN13, EAN8, UPC, ITF14, MSI, pharmacode
            `;
        }
    </script>
</body>
</html>
